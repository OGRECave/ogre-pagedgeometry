<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PagedGeometry: Tutorial 3: Grass and Shadows</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PagedGeometry
   &#160;<span id="projectnumber">1.3.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('tut3.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Tutorial 3: Grass and Shadows </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__home_pavel_workspace_ogre_pagedgeometry_docs_Tutorial_3"></a> </p>
<h1><a class="anchor" id="autotoc_md16"></a>
Introduction</h1>
<p>At this point you should be fairly familiar with the basic use of PagedGeometry to add trees and bushes to your world. Now it's time to add some grass. This tutorial explains the use of PagedGeometry's GrassLoader module to add animated grass to your scene, and how to apply shadows (lightmaps) to your grass and trees to greatly improve the graphical realism.</p>
<h2><a class="anchor" id="autotoc_md17"></a>
Tutorial Requirements</h2>
<ul>
<li><a class="el" href="tut1.html">Tutorial 1: Getting Started</a> (#2 also recommended)</li>
<li>A basic understanding of <a class="elRef" href="https://ogrecave.github.io/ogre/api/latest/namespace_ogre.html">Ogre</a></li>
<li>Some experience using C++</li>
</ul>
<p>See also</p>
<ul>
<li>Example 4 - “GrassLoader”</li>
<li>Example 7 - “Lightmaps”</li>
</ul>
<h1><a class="anchor" id="autotoc_md18"></a>
GrassLoader</h1>
<p>GrassLoader, like TreeLoader2D and TreeLoader3D, is a module that provides the core engine with the geometry you want rendered. Using one of the TreeLoader classes to add grass would be extremely tedious and inefficient, since each blade or clump of grass would need to be added individually. For this reason, GrassLoader exists to provide you an easy to use, efficient grass renderer.</p>
<p>It is important to note that GrassLoader differs in two significant ways from the other PageLoader's:</p>
<ol type="1">
<li>You can't use ImpostorPage to display grass. Since grass is displayed using many small non camera-aligned billboards, it's already as optimized as possible, geometrically. Attempting to use impostors for grass will result in a lot of impostor rendering, a lot of wasted memory, and a lot of lag when loading new pages. You should use either BatchPage, or preferably “GrassPage” to display grass, the latter being the most optimized.</li>
<li>Fade transitions are always used on grass, and do not cost any performance. When configuring the PagedGeometry object used to render your grass, do *not *enable transitions yourself. Doing this will only reduce performance unnecessarily.</li>
</ol>
<h1><a class="anchor" id="autotoc_md19"></a>
Creating Grass</h1>
<p>To add grass to your world, you start by creating a PagedGeometry object, as always:</p>
<div class="fragment"><div class="line">PagedGeometry *grass = <span class="keyword">new</span> PagedGeometry(camera, 50);</div>
</div><!-- fragment --><p>But this time, instead of adding the usual BatchPage and ImpostorPage combination that works well for trees, GrassPage will be used:</p>
<div class="fragment"><div class="line">grass-&gt;addDetailLevel&lt;GrassPage&gt;(100);<span class="comment">//Draw grass up to 100</span></div>
<div class="line">units away</div>
</div><!-- fragment --><p>GrassPage is the most effecient LOD to use when displaying grass, and should be used exclusively for this purpose (in other words, it's <em>not</em> effecient for displaying trees).</p>
<p>Next, setup a new GrassLoader instance to be used with this PagedGeometry object:</p>
<div class="fragment"><div class="line">GrassLoader *grassLoader = <span class="keyword">new</span> GrassLoader(grass);</div>
<div class="line"> </div>
<div class="line">grass-&gt;setPageLoader(grassLoader);</div>
<div class="line"> </div>
<div class="line">grassLoader-&gt;setHeightFunction(&amp;getTerrainHeight);</div>
</div><!-- fragment --><p>In addition to creating and assigning a GrassLoader instance to the PagedGeometry object, you can see this code calls setHeightFunction(). Like TreeLoader2D, GrassLoader calculates the Y positions of grasses during runtime with this function. This is usually set to a function that returns the height of your terrain at the given point, so the grass/trees/etc appear directly on the surface of the terrain.</p>
<p>At this point PagedGeometry is fully configured to display grass! All you need to do is add some:</p>
<div class="fragment"><div class="line">GrassLayer *layer = grassLoader-&gt;addLayer(<span class="stringliteral">&quot;GrassMaterial&quot;</span>);</div>
</div><!-- fragment --><p>If you ran the application at this point, you would see your entire terrain covered in grass (provided that grass-&gt;update() is called every frame, of course). addLayer() basically adds a "layer" of grass to your scene which will appear everywhere, by default. In this case, grass is added and textured with "GrassMaterial".</p>
<p>The GrassLayer object returned allows you to configure the grass any way you want. You can adjust the size, animation, density, etc through this object. For example:</p>
<div class="fragment"><div class="line">layer-&gt;setMinimumSize(2.0f, 2.0f);</div>
<div class="line"> </div>
<div class="line">layer-&gt;setMaximumSize(2.5f, 2.5f);</div>
<div class="line"> </div>
<div class="line">layer-&gt;setAnimationEnabled(<span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line">layer-&gt;setSwayDistribution(10.0f);</div>
<div class="line"> </div>
<div class="line">layer-&gt;setSwayLength(0.5f);</div>
<div class="line"> </div>
<div class="line">layer-&gt;setSwaySpeed(0.5f);</div>
<div class="line"> </div>
<div class="line">layer-&gt;setDensity(1.5f);</div>
<div class="line"> </div>
<div class="line">layer-&gt;setFadeTechnique(FADETECH_GROW);</div>
</div><!-- fragment --><p>As you can see, this sets the grass size, enables animations, configures the sway animation style, sets the density, and customizes the fade technique. All these options are fully documented in the PagedGeometry API documentation, so please refer to it for more detailed information about configuring your GrassLayer.</p>
<p>If you want, you can add more and more layers until you have all the grass variety you want. This tutorial will just use the single grass layer created above, for simplicity.</p>
<p>In most cases, you won't want the grass to grow <em>everywhere</em>. You might only want grass to appear in fields, or on lawn areas, for example. GrassLoader gives you complete control over the density levels of grass anywhere on your terrain through <em>density maps</em>. A density map is simply a greyscale 2D image you provide, where a white pixel indicates full grass density, and a black pixel indicates no grass at all (of course, any shade in between can be used too). You can literally "draw" grass into your world with any paint program by simply drawing a pattern image and using that image as a density map. For example, if your density map has a big round white circle in the middle, there will be a big round white circle of grass in the middle of your terrain.</p>
<p>But first, you need to specify the boundaries of your terrain, so the grass engine will know where your density map is to be applied:</p>
<div class="fragment"><div class="line">layer-&gt;setMapBounds(TBounds(0, 0, 1500, 1500));</div>
</div><!-- fragment --><p>The line above configures the grass layer so the density map will take effect in the square region from (0x, 0z) to (1500x, 1500z). Usually you should supply the boundaries of your terrain here, since that's often the desired behavior.</p>
<p>Now, use setDensityMap() to supply your density map image:</p>
<div class="fragment"><div class="line">layer-&gt;setDensityMap(<span class="stringliteral">&quot;GrassMap.png&quot;</span>);</div>
</div><!-- fragment --><p>Note that the density map parameter is the filename of an image, not an <a class="elRef" href="https://ogrecave.github.io/ogre/api/latest/namespace_ogre.html">Ogre</a> Material. A material wouldn't make sense here, since it's not actually going to be applied as a texture to anything.</p>
<p>Try running your application. The patterns of your grassmap should show up in your game world as different densities of grass. Now you have full control over where and how your grass grows.</p>
<p>You can get a full working example of what you learned about grass by opening the "Example 3 – Trees and Bushes" project found in the examples folder.</p>
<h1><a class="anchor" id="autotoc_md20"></a>
Adding Shadows</h1>
<p>At this point you should be able to add trees and grass wherever you want in your world, but there's one very important aspect that's missing: shadows. Without any shadows being applied to the trees and grass, they will often look out of place against the dark, shadowed sides of your mountains. This can be fixed by applying a lightmap to your trees and grass that shades them according to the terrain.</p>
<p>To apply a lightmap to grass, use the setColorMap() function, like this:</p>
<div class="fragment"><div class="line">layer-&gt;setColorMap(“LightMap.png”);</div>
</div><!-- fragment --><p>And that's all there is to it, basically. Just make sure setMapBounds() is called at some point, since both color maps and density maps can't be applied without boundary information.</p>
<p>You may notice that "set**Color**Map" allows you to not only configure the shade of grass, but the coloration as well. You can use this feature to not only shade grass, but also color it to the terrain's features. For example, if you make your grass texture white (instead of green or whatever), you can apply your terrain's texture as a color map, and the grass will match up to the terrain perfectly. This often produces a very nice, smooth look to the grass, and blends in very well to the terrain. See Example 4 for an example of this.</p>
<p>Applying a lightmap to your trees is just as easy as with GrassLoader, since TreeLoader2D and TreeLoader3D both include a setColorMap() function. For example, you can do this:</p>
<div class="fragment"><div class="line">treeLoader-&gt;setColorMap(“LightMap.png”);</div>
</div><!-- fragment --><p>Where "treeLoader" is a pointer to your TreeLoader2D or TreeLoader3D object. Unlike GrassLayer, there's no setMapBounds() function; the color map always takes effect in the boundary you specify in the TreeLoader2D/TreeLoader3D constructor.</p>
<p>For a full working example of tree and grass shadows, take a look at the "Lightmaps" example (Example 7) in the examples folder.</p>
<h1><a class="anchor" id="autotoc_md21"></a>
Updating PagedGeometry</h1>
<p>As always, you need to call PagedGeometry::update() in order for the grass, etc to be displayed</p>
<div class="fragment"><div class="line">[each frame]</div>
<div class="line"> </div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">grass-&gt;update();</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md22"></a>
Conclusion</h1>
<p>As you can see, adding grass and applying shadows to your scene isn't very difficult – it's simply a matter of specifying the desired properties (grass texture, size, density, lightmap, etc). For a full working example of what you learned in this tutorial, see "Example 7 –
Lightmaps", found in the examples folder. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
