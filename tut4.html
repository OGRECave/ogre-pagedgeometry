<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PagedGeometry: Tutorial 4: Custom PageLoader</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PagedGeometry
   &#160;<span id="projectnumber">1.3.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('tut4.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Tutorial 4: Custom PageLoader </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__home_pavel_workspace_ogre_pagedgeometry_docs_Tutorial_4"></a></p>
<h1><a class="anchor" id="autotoc_md23"></a>
Introduction</h1>
<p>This tutorial explains how you can make your own custom PageLoader-derived class (like GrassLoader, TreeLoader2D, and TreeLoader3D) to have complete control over the dynamic loading process. By implementing your own PageLoader, you can load your trees, etc. from literally any source you can imagine, including hard disks, CDs, the Internet, and even procedurally.</p>
<h2><a class="anchor" id="autotoc_md24"></a>
Tutorial Requirements</h2>
<ul>
<li>A fair understanding of PagedGeometry basics (see tutorials 1 – 3)</li>
<li>A basic understanding of <a class="elRef" href="https://ogrecave.github.io/ogre/api/latest/namespace_ogre.html">Ogre</a></li>
<li>An fair understanding of C++ inheritance and polymorphism</li>
</ul>
<h1><a class="anchor" id="autotoc_md25"></a>
How a PageLoader Works</h1>
<p>By now you should know basically what a PageLoader is – it's a abstract class which is used to load all kinds of geometry (trees, grass, etc.) into PagedGeometry, since the PagedGeometry class itself has no built-in functions for the addition of trees, grass, etc. to the scene. This way, you can implement PageLoader – derived classes which allow your geometry to be added to the scene in literally any way you want. As you've seen, PagedGeometry includes several PageLoader classes by default, which can be used to easily display what you want.</p>
<p>As you probably know, PagedGeometry doesn't load everything in the scene all at one – it loads only what it needed to display visible trees, etc. This means entities are loaded dynamically, as your camera moves around in the world. When PagedGeometry needs a certain region of entities to be loaded, it will call on the PageLoader to do so. In other words, implementing a PageLoader is as simple as implementing a loadPage() function that loads entities within a requested boundary.</p>
<h1><a class="anchor" id="autotoc_md26"></a>
Defining a PageLoader</h1>
<p>To create a custom PageLoader, simply declare a class deriving from PageLoader. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>CustomLoader: <span class="keyword">public</span> PageLoader</div>
<div class="line"> </div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loadPage(PageInfo &amp;page);</div>
<div class="line"> </div>
<div class="line">};</div>
</div><!-- fragment --><p>As you can see, the PageLoader structure is very simple; it's basically just a callback. Once you implement the loadPage() function, your new PageLoader will be ready for use!</p>
<p>Here's an example implementation of loadPage(), which will populate the trees randomely:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> CustomLoader::loadPage(PageInfo &amp;page)</div>
<div class="line"> </div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"><a class="codeRef" href="https://ogrecave.github.io/ogre/api/latest/class_ogre_1_1_vector.html">Vector3</a> position;</div>
<div class="line"> </div>
<div class="line">Quaternion rotation;</div>
<div class="line"> </div>
<div class="line"><a class="codeRef" href="https://ogrecave.github.io/ogre/api/latest/class_ogre_1_1_vector.html">Vector3</a> scale;</div>
<div class="line"> </div>
<div class="line">ColourValue color;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &amp;lt; 100; i++){</div>
<div class="line"> </div>
<div class="line"><span class="comment">//Calculate a random rotation around the Y axis</span></div>
<div class="line"> </div>
<div class="line">rotation = Quaternion(Degree(Math::RangeRandom(0, 360)),</div>
<div class="line">Vector3::UNIT\_Y);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//Calculate a position within the specified boundaries</span></div>
<div class="line"> </div>
<div class="line">position.x = Math::RangeRandom(page.bounds.left, page.bounds.right);</div>
<div class="line"> </div>
<div class="line">position.z = Math::RangeRandom(page.bounds.top, page.bounds.bottom);</div>
<div class="line"> </div>
<div class="line">position.y = HeightFunction::getTerrainHeight(position.x, position.z);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//Calculate a scale value (uniformly scaled in all dimensions)</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">float</span> uniformScale = Math::RangeRandom(0.5f, 0.6f);</div>
<div class="line"> </div>
<div class="line">scale.x = uniformScale;</div>
<div class="line"> </div>
<div class="line">scale.y = uniformScale;</div>
<div class="line"> </div>
<div class="line">scale.z = uniformScale;</div>
<div class="line"> </div>
<div class="line"><span class="comment">//All trees will be fully lit in this demo</span></div>
<div class="line"> </div>
<div class="line">color = ColourValue::White;</div>
<div class="line"> </div>
<div class="line"><span class="comment">//Add a tree to the scene at the desired location</span></div>
<div class="line"> </div>
<div class="line">addEntity(myTree, position, rotation, scale, color);</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="ttc" id="aclass_ogre_1_1_vector_html"><div class="ttname"><a href="https://ogrecave.github.io/ogre/api/latest/class_ogre_1_1_vector.html">Vector&lt; 3, Real &gt;</a></div></div>
</div><!-- fragment --><p>This example basically adds 100 trees to PagedGeometry with addEntity(). addEntity() is a function in the base PageLoader class through which all geometry is eventually added to PagedGeometry. To use addEntity(), simply specify the desired entity, postion, rotation, scale, and color.</p>
<p>The most important concept of this function is that the entities which are being added are <em>all</em> within the given boundaries. The boundaries, as well as other useful information, is passed to loadPage() through a PageInfo struct. For example, the X/Z position in the above loadPage() implementation is calculated like this:</p>
<div class="fragment"><div class="line">position.x = Math::RangeRandom(page.bounds.left, page.bounds.right);</div>
<div class="line"> </div>
<div class="line">position.z = Math::RangeRandom(page.bounds.top, page.bounds.bottom);</div>
</div><!-- fragment --><p>So the trees will be between page.bounds.left – page.bounds.right in the X coordinate, and between page.bounds.top – page.bounds.bottom in the Z coordinate. It's important that you don't add any entities outside of these boundaries; when PagedGeometry asks you for a certain region of entities to be loaded, it expects exactly that to be done – attempting to add entities anywhere else may crash the application.</p>
<h1><a class="anchor" id="autotoc_md27"></a>
A “Page” of Geometry</h1>
<p>As mentioned above, your loadPage() function is simply given a desired rectangular boundary along the X/Z plane, and the task of filling those boundaries with the desired entities. Implementing an effecient PageLoader with this information alone would be extremely difficult in many cases, since retreiving some random rectangular region of entities usually isn't very effecient.</p>
<p>There's one fact that can be extremely helpful when implemeting your PageLoader: The boundaries you are requested to fill out will <em>always</em> have the same width and height (both being equivelant to the value given to PagedGeometry::setPageSize()), and will <em>always</em> be a single "tile" of an infinitely sized "virtual grid".</p>
<p>It may be helpful to picture the actual layout of your trees as being divided into a huge grid, where each "tile" of that grid (called a "page") can be individually loaded and unloaded. The PageInfo parameter specified to your loadPage() function will always be providing the boundaries, etc. of <em>one</em> of those tiles, which you need to load. In fact, you could implement your entire loadPage() function if only given the x and z indexes of the desired tile.</p>
<h1><a class="anchor" id="autotoc_md28"></a>
Conclusion</h1>
<p>A PageLoader is nothing more than an advanced callback function; when the PagedGeometry engine decides a certain page of geometry needs to be loaded, it calls on the PageLoader to do this. While creating your own custom PageLoader class is an advanced, and sometimes difficult task, it's really very simple in concept. Through custom PageLoader's, your trees, grass, etc can now be loaded from literally any source you can imagine. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
